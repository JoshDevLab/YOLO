<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jinmj">

	<!-- 부서 조회하기 -->
	<resultMap type="HashMap" id="deptMap">
		<result property="deptname" column="deptname" javaType="String"/>
		<result property="deptno" column="deptno" javaType="String"/>
	</resultMap>
	<select id="selectDept"  parameterType="String" resultMap="deptMap">
		select  deptname, deptno
		from TBL_DEPT
		where upper_deptno = #{deptno}
	</select>
	
	
	<!-- <resultMap type="HashMap" id="deptPeopleMap">
		<result property="empno" column="empno" javaType="String"/>
		<result property="name" column="name" javaType="String"/>
	</resultMap>
	<select id="selectDept" resultMap="deptPeopleMap" parameterType="String">
		select M.empno, M.name
		from TBL_EMPLOYEES M join  TBL_DEPT D
		on M.fk_deptno = D.deptno
		where  STATUS='재직' AND ( fk_deptno = #{deptno} OR upper_deptno = #{deptno} )
		order by M.fk_deptno asc;
	</select> -->
	
	
	<!-- 부서 사람들 조회하기 -->
	<resultMap type="HashMap" id="deptPeopleMap">
		<result property="empno" column="empno" javaType="String"/>
		<result property="name" column="name" javaType="String"/>
	</resultMap>
	<select id="selectDeptPerson" parameterType="String" resultMap="deptPeopleMap">
		select empno, name
		from TBL_EMPLOYEES
		where STATUS='재직' AND fk_deptno = #{deptno}
	</select>
	
	
	
	<!-- 선택한 유저 목록 가져오기 -->
	<resultMap type="HashMap" id="chooseEmpMap">
		<result property="name" column="name" javaType="String"/>
		<result property="position" column="position" javaType="String"/>
		<result property="deptname" column="deptname" javaType="String"/>
		<result property="profile_color" column="profile_color" javaType="String"/>
		<result property="empno" column="empno" javaType="String"/>
	</resultMap>
	<select id="selectChooseEmp" parameterType="String" resultMap="chooseEmpMap">
		select name, position, deptname, profile_color, empno
		from
		(
		    select name, position, fk_deptno, PROFILE_COLOR, empno
		    from TBL_EMPLOYEES
		    where empno in (${str_empno})
		)
		join TBL_DEPT
		on fk_deptno = deptno
		order by fk_deptno, empno
	</select>
	
	
	
	<!-- 공지 알림 보내기 -->
	<insert id="insertSendNotice" parameterType="String"  >
		${sql}
	</insert>
	
	
	
	<!-- 작성한 공지 리스트 가져오기 -->
	<resultMap type="HashMap" id="NoticeMap">
		<result property="name" column="name" javaType="String"/>
		<result property="deptname" column="deptname" javaType="String"/>
		<result property="position" column="position" javaType="String"/>
		<result property="profile_color" column="profile_color" javaType="String"/>
		<result property="notino" column="notino" javaType="String"/>
		<result property="fk_recipientno" column="fk_recipientno" javaType="String"/>
		<result property="subject" column="subject" javaType="String"/>
		<result property="content" column="content" javaType="String"/>
		<result property="status" column="status" javaType="String"/>
		<result property="writedate" column="writedate" javaType="String"/>
		<result property="notiLevel" column="notiLevel" javaType="String"/>
		<result property="readCount" column="readCount" javaType="String"/>
		<result property="cmtCount" column="cmtCount" javaType="String"/>
	</resultMap>
	<select id="selectSentNoticeList" parameterType="String" resultMap="NoticeMap">
		select name, deptname, position, profile_color, notino , fk_recipientno, subject, content, status
			,  to_char(WRITEDATE , 'yyyy-mm-dd hh24:mi:ss' ) as writedate
			, notiLevel, readCount, cmtCount
		from
		(
		    select notino , FK_RECIPIENTNO, SUBJECT, CONTENT, STATUS, WRITEDATE, notiLevel, readCount, cmtCount
		    from tbl_notice
		    where FK_SENDERNO = #{empno}
		)
		join 
		( 
		    select empno, NAME, position, DEPTNAME, PROFILE_COLOR
		    from TBL_EMPLOYEES M join  TBL_DEPT D
		    on M.fk_deptno = D.deptno
		
		) 
		on FK_RECIPIENTNO = empno
		order by WRITEDATE desc
	
	</select>
	
	<!--  
	<select id="wholeNoticeList" resultType="com.yolo.hr.jinji.notice.model.NoticeVO">
		SELECT N.notino, N.fk_senderno, N.notiLevel, to_char(N.writedate, 'yyyy-mm-dd') AS writedate, N.subject, N.content, N.readCount, N.cmtCount
		      , E.name, E.profile_color
		FROM tbl_notice N
		JOIN tbl_employees E
		ON N.fk_senderno = E.empno
		order by notino desc
	</select>
	-->


</mapper>
